
            <!-- Fan 1 -->
            <img id="fan1" src="{{ url_for('static', filename='images/fan000.gif') }}"
                style="position:absolute; left:511px; top:208px; width:42px; height:42px; border-radius: 60px; border: 2.5px solid black; padding:8px;">


            # DI_Spg2_iFl_RetAFan1_ON    DI_Spg2_iFl_RetAFan1_OFF   
            <div
                style="position: absolute; left: 576px; top: 208px; width: 17px; height: 17px; border: 1px solid black; display: flex; align-items: center; justify-content: center;">
                <button id="fan1-toggle" onclick="toggleFan('fan1')"
                    style="width: 13px; height: 13px; background-color: green; border: none; border-radius: 50%; box-shadow: 0px 0px 3px rgba(0, 0, 0, 0.2);">
                </button>
            </div>

            # DI_Spg2_iFl_RetAFan1_TRIP
            <div
                style="position: absolute; left: 596px; top: 208px; width: 17px; height: 17px; display: flex; align-items: center; justify-content: center;">
                <button id="fan1-trip" onclick="toggleTrip('fan1')"
                    style="width: 13px; height: 13px; background-color: white; border: none; border-radius: 50%; outline: none;">
                </button>
            </div>

            # DI_Spg2_iFl_RetAFan2_ON   DI_Spg2_iFl_RetAFan2_OFF   
            <!-- Fan 2 -->
            <img id="fan2" src="{{ url_for('static', filename='images/fan000.gif') }}"
                style="position:absolute; left:511px; top:320px; width:42px; height:42px; border-radius: 60px; border: 2.5px solid black; padding:8px;">

            <div
                style="position: absolute; left: 576px; top: 320px; width: 17px; height: 17px; border: 1px solid black; display: flex; align-items: center; justify-content: center;">
                <button id="fan2-toggle" onclick="toggleFan('fan2')"
                    style="width: 13px; height: 13px; background-color: green; border: none; border-radius: 50%; box-shadow: 0px 0px 3px rgba(0, 0, 0, 0.2);">
                </button>
            </div>

            # DI_Spg2_iFl_RetAFan2_TRIP
            <div
                style="position: absolute; left: 596px; top: 320px; width: 17px; height: 17px; display: flex; align-items: center; justify-content: center;">
                <button id="fan2-trip" onclick="toggleTrip('fan2')"
                    style="width: 13px; height: 13px; background-color: white; border: none; border-radius: 50%; outline: none;">
                </button>
            </div>

            <!-- Fan 3 -->
            <img id="fan3" src="{{ url_for('static', filename='images/fan000.gif') }}"
                style="position:absolute; left:1273px; top:391px; width:42px; height:42px; border-radius: 60px; border: 2.5px solid black; padding:8px;">

            # DI_Spg2_iFl_SAFan1_ON    DI_Spg2_iFl_SAFan1_OFF
            <div
                style="position: absolute; left: 1338px; top: 391px; width: 17px; height: 17px; border: 1px solid black; display: flex; align-items: center; justify-content: center;">
                <button id="fan3-toggle" onclick="toggleFan('fan3')"
                    style="width: 13px; height: 13px; background-color: green; border: none; border-radius: 50%; box-shadow: 0px 0px 3px rgba(0, 0, 0, 0.2);">
                </button>
            </div>

            # DI_Spg2_iFl_SAFan1_TRIP
            <div
                style="position: absolute; left: 1358px; top: 391px; width: 17px; height: 17px; display: flex; align-items: center; justify-content: center;">
                <button id="fan3-trip" onclick="toggleTrip('fan3')"
                    style="width: 13px; height: 13px; background-color: white; border: none; border-radius: 50%; outline: none;">
                </button>
            </div>



            # DI_Spg2_iFl_RDF1_ON    DI_Spg2_iFl_RDF1_OFF
            <div
                style="position: absolute; left: 318px; top: 348px; width: 17px; height: 17px; border: 1px solid black; display: flex; align-items: center; justify-content: center;">
                <button id="button1_1"
                    style="width: 13px; height: 13px; background-color: red; border-radius: 50%; border: none;"
                    onclick="changeColor('button1_1')"></button>
            </div>

            # DI_Spg2_iFl_RDF1_TRIP
            <div
                style="position: absolute; left: 338px; top: 348px; width: 17px; height: 17px; border: 1px solid black; display: flex; align-items: center; justify-content: center;">
                <button id="button2_1"
                    style="width: 13px; height: 13px; background-color: yellow; border-radius: 50%; border: none;"
                    onclick="changeColor('button2_1')"></button>
            </div>


            #  DI_Spg2_iFl_DCF1_ON        DI_Spg2_iFl_DCF1_OFF
            <div
                style="position: absolute; left: 418px; top: 500px; width: 17px; height: 17px; border: 1px solid black; display: flex; align-items: center; justify-content: center;">
                <button id="button1_4"
                    style="width: 13px; height: 13px; background-color: red; border-radius: 50%; border: none;"
                    onclick="changeColor('button1_4')"></button>
            </div>


            # DI_Spg2_iFl_DCF1_TRIP
            <div
                style="position: absolute; left: 438px; top: 500px; width: 17px; height: 17px; border: 1px solid black; display: flex; align-items: center; justify-content: center;">
                <button id="button2_4"
                    style="width: 13px; height: 13px; background-color: yellow; border-radius: 50%; border: none;"
                    onclick="changeColor('button2_4')"></button>
            </div>


            #  DI_Spg2_iFl_ScrewCompactor1_ON      DI_Spg2_iFl_ScrewCompactor1_OFF
            <div
                style="position: absolute; left: 575px; top: 540px; width: 17px; height: 17px; border: 1px solid black; display: flex; align-items: center; justify-content: center;">
                <button id="button1_2"
                    style="width: 13px; height: 13px; background-color: red; border-radius: 50%; border: none;"
                    onclick="changeColor('button1_2')"></button>
            </div>

            # DI_Spg2_iFl_ScrewCompactor1_TRIP
            <div
                style="position: absolute; left: 595px; top: 540px; width: 17px; height: 17px; border: 1px solid black; display: flex; align-items: center; justify-content: center;">
                <button id="button2_2"
                    style="width: 13px; height: 13px; background-color: yellow; border-radius: 50%; border: none;"
                    onclick="changeColor('button2_2')"></button>
            </div>


            #  DI_Spg2_iFl_WasherPump1_ON   DI_Spg2_iFl_WasherPump1_OFF
            <div
                style="position: absolute; left: 1080px; top: 353px; width: 17px; height: 17px; border: 1px solid black; display: flex; align-items: center; justify-content: center;">
                <button id="button1_3"
                    style="width: 13px; height: 13px; background-color: red; border-radius: 50%; border: none;"
                    onclick="changeColor('button1_3')"></button>
            </div>

            #  DI_Spg2_iFl_WasherPump1_TRIP
            <div
                style="position: absolute; left: 1100px; top: 353px; width: 17px; height: 17px; border: 1px solid black; display: flex; align-items: center; justify-content: center;">
                <button id="button2_3"
                    style="width: 13px; height: 13px; background-color: yellow; border-radius: 50%; border: none;"
                    onclick="changeColor('button2_3')"></button>
            </div>


            <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
        <script>
            // Initialize Socket.IO client
            const socket = io.connect('http://' + document.domain + ':' + location.port);

            // Function to format numbers
            function formatValue(value) {
                let floatValue = parseFloat(value);
                return floatValue % 1 === 0 ? floatValue.toString() : floatValue.toFixed(2);
            }

            // Listen for updates from the server
            socket.on('update', function (data) {
                document.getElementById('counter').textContent = formatValue(data.Counter);
                document.getElementById('random').textContent = formatValue(data.Random);
                document.getElementById('sawtooth').textContent = formatValue(data.Sawtooth);
                document.getElementById('sinusoid').textContent = formatValue(data.Sinusoid);
                document.getElementById('square').textContent = formatValue(data.Square);
                document.getElementById('triangle').textContent = formatValue(data.Triangle);
                document.getElementById('random2').textContent = formatValue(data.Random);
            });

            function changeColor(buttonId) {
                const button = document.getElementById(buttonId);
                const [group, pair] = buttonId.split("_"); // Extract group (1 or 2) and pair number (e.g., 1, 2, 3, 4)
                const otherButtonId = (group === "button1" ? `button2_${pair}` : `button1_${pair}`);
                const otherButton = document.getElementById(otherButtonId);
                const container = button.parentElement; // Assuming container is the parent element of the buttons

                if (group === "button1") {
                    // Button 1_x Logic
                    if (otherButton.style.backgroundColor === "yellow") {
                        button.style.backgroundColor = "red"; // Stay red if paired button is yellow
                    } else {
                        button.style.backgroundColor = button.style.backgroundColor === "red" ? "green" : "red";
                    }
                } else if (group === "button2") {
                    // Button 2_x Logic
                    if (button.style.backgroundColor === "yellow") {
                        button.style.backgroundColor = "white";
                        container.style.border = "none"; // Remove the container's border
                        otherButton.style.backgroundColor = "red"; // Ensure the first button turns red when tripped
                    } else {
                        button.style.backgroundColor = "yellow";
                        container.style.border = "1px solid black"; // Add border
                        otherButton.style.backgroundColor = "red"; // Ensure the first button turns red when tripped
                    }
                }

                // Ensure the first button is always visible
                ensureVisibility(otherButton, group);
            }

            function ensureVisibility(button, group) {
                if (group === "button1") {
                    // First button should never be hidden
                    button.style.display = "inline-block";
                }
            }



            // <-- fan -->

            let fanStates = {
                "fan1": { running: true, tripped: false },
                "fan2": { running: true, tripped: false },
                "fan3": { running: true, tripped: false }
            };

            // Helper to update fan visuals
            function updateFanVisuals(fanId) {
                const fanImg = document.getElementById(fanId);
                const toggleButton = document.getElementById(`${fanId}-toggle`);
                const tripButton = document.getElementById(`${fanId}-trip`);

                if (fanStates[fanId].tripped) {
                    // Fan is tripped
                    fanImg.src = staticImagePath("fan_stopped.png");
                    toggleButton.style.backgroundColor = "red";
                    tripButton.style.backgroundColor = "yellow";
                    tripButton.parentElement.style.border = "1px solid black";
                } else {
                    // Fan is not tripped
                    tripButton.style.backgroundColor = "white";
                    tripButton.parentElement.style.border = "none";

                    if (fanStates[fanId].running) {
                        fanImg.src = staticImagePath("fan000.gif");
                        toggleButton.style.backgroundColor = "green";
                        tripButton.style.display = "inline-block";
                    } else {
                        fanImg.src = staticImagePath("fan_stopped.png");
                        toggleButton.style.backgroundColor = "red";
                        tripButton.style.display = "none";
                    }
                }
            }

            // Toggle the fan state (running/stopped)
            function toggleFan(fanId) {
                if (!fanStates[fanId].tripped) {
                    fanStates[fanId].running = !fanStates[fanId].running;
                    updateFanVisuals(fanId);
                }
            }

            // Toggle the trip state of the fan
            function toggleTrip(fanId) {
                fanStates[fanId].tripped = !fanStates[fanId].tripped;
                updateFanVisuals(fanId);
            }

            // Helper for generating static file paths
            function staticImagePath(filename) {
                return `/static/images/${filename}`;
            }



        </script>

        <script>
            // Get the active submodule variable from the server
            const activeSubmodule = "{{ active_submodule }}";  // Use Jinja to get the value

            // This function will trigger the submodule toggle
            function openActiveSubmodule() {
                const buttonElement = document.querySelector(`button[id$='${activeSubmodule.replace('Submodules', '')}']`);
                if (buttonElement) {
                    buttonElement.click();  // Simulate click on the module button to open it
                }
            }

            // Call the function when the page loads
            window.onload = function () {
                openActiveSubmodule();
            };
        </script>










<<<<<<< HEAD
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}TSE Control System{% endblock %}</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>


    <style>
        body {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        html,
        body {
            height: 100%;
        }

        .sidebar {
            position: fixed;
            width: 168px;
            height: 90%;
            top: 60px;
            left: -2px;
            background-color: #3273a1;
            padding-top: 2px;
            color: white;
            border-right: 3px solid rgba(173, 216, 230, 0.6);
            overflow-y: scroll;
            /* Enable scrolling */
            -ms-overflow-style: none;
            /* Hide scrollbar in IE 10+ */
            scrollbar-width: none;
            /* Hide scrollbar in Firefox */
        }

        .sidebar::-webkit-scrollbar {
            display: none;
            /* Hide scrollbar in Chrome, Safari, and Edge */
        }



        .module-button {
            display: flex;
            align-items: center;
            width: 100%;
            background: linear-gradient(rgba(0, 51, 102, 0.9) 0%, rgba(173, 216, 230, 0.6) 98%);
            color: rgb(238, 238, 255);
            padding-left: 15px;
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            border: none;
            outline: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: background-color 0.3s ease;
            border-bottom: 0.2px solid black;
            position: relative;
            font-style: Roboto Mono;
        }

        .module-button:hover {
            background-color: #005fa3;
        }



        .submodule-container {
            display: none;
            background: linear-gradient(rgba(0, 51, 102, 0.9) 0%, rgba(173, 216, 230, 0.6) 98%);
        }


        .submodule-button {
            width: 100%;
            background-color: rgba(0, 99, 132, 0.6);
            color: white;
            padding-left: 32px;
            padding-bottom: 10px;
            padding-top: 10px;
            font-weight: 600;
            border: none;
            outline: none;
            font-size: 12px;
            margin-bottom: 0px;
            text-align: left;
            /* cursor: pointer; */
            border-bottom: 1px solid black;
            position: relative;
        }

        .submodule-button:hover {
            background-color: #005fa3;
        }

        .dropdown-icon {
            position: absolute;
            right: 12px;
            font-size: 12px;
            cursor: pointer;
        }

        .content {
            margin-left: 160px;
            padding: 20px;
        }

        .fa-house,
        .fa-building,
        .fa-triangle-exclamation,
        .fa-gear,
        .fa-file,
        .fa-user-cog {
            font-size: 11px;
            padding-right: 7px;
        }

        .fa-user-plus,
        .fa-user-pen {
            font-size: 10px;
            padding-right: 6px;
        }

        .active {
            background-color: #003e6d;
            /* Darker background for the active button */
        }

        .title-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(rgba(0, 51, 102, 0.9) 0%, rgba(173, 216, 230, 0.6) 98%);
            background-color: #005fa3;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            border-bottom: 3px solid rgba(173, 216, 230, 0.6);
        }

        .company-logo {
            margin-top: 8px;
            height: 40px;
            width: 40px;
            margin-left: 28px;
            background-color: white;
            border-radius: 50px;
        }

        .company-name {
            font-size: 24px;
            font-weight: bold;
            flex-grow: 1;
            text-align: center;
            color: white;
        }

        .client-name {
            font-size: 15px;
            font-weight: bold;
            flex-grow: 1;
            text-align: center;
            color: white;
        }

        .left-section {
            display: flex;
            border-right: 2px solid rgba(173, 216, 230, 0.6);
            top: 0px;
            padding-right: 78px;
            width: fit-content;
            height: 60px;
        }

        .login-button {
            font-size: 14px;
            color: #fff;
            background-color: #005fa3;
            margin-top: 6px;
            padding: 8px 18px;
            border: 1px solid black;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-right: 8px;
            text-decoration: none;
        }

        .login-button:hover {
            background-color: #003e6d;
        }

        .right-section {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            width: auto;
        }

        .profile-icon-button {
            background-color: transparent;
            border: none;
            cursor: pointer;
            color: white;
            font-size: 24px;
            position: relative;
        }

        .profile-icon-button:hover {
            color: #003e6d;
            cursor: pointer;
        }

        /* Circle profile icon styles */
        .profile-icon {
            position: relative;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: #005fa3;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            font-weight: bold;
            margin-right: 10px;
            border: 2px solid #005591;
            margin-top: 6px;
            cursor: pointer;
        }

        /* Tooltip content style */
        .tooltip-content {
            position: absolute;
            top: 9%;
            /* Position it just below the profile icon */
            left: 87%;
            /* Center it horizontally */
            transform: translateX(-50%);
            /* Adjust for perfect centering */
            width: 180px;
            /* Set the desired width */
            height: 40px;
            /* Set the desired height */
            background-color: rgba(129, 183, 201, 0.6);
            color: black;
            padding: 6px;
            /* Add some padding inside */
            border-radius: 5px;
            box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
            font-size: 14px;
            z-index: 2;
            display: none;
            /* Initially hidden */
            overflow: hidden;
            /* Ensures content does not overflow outside the tooltip */
            text-overflow: ellipsis;
            /* Adds ellipsis if the text overflows */
            white-space: nowrap;
            /* Prevents text from breaking into multiple lines */
            border: 1px solid rgba(95, 149, 167, 0.6);
            /* text-align: center; */

        }

        .tooltip-content p {
            margin: 0;
            /* Remove any default margins */
            overflow: hidden;
            /* Prevent content overflow */
            text-overflow: ellipsis;
            /* Add ellipsis for overflowing text */
            line-height: 24px;
            /* Adjust line height for better readability */
            font-size: 12px;
            /* Adjust font size if needed */
            word-wrap: break-word;
            /* Ensures content breaks correctly if needed */
            font-weight: bold;
        }


        /* Show the tooltip when hovering over the profile icon */
        .profile-icon:hover+#profile-tooltip {
            display: block;
        }


        /* Dropdown menu styles */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            top: 58px;
            /* Adjust this to position the dropdown below the profile icon */
            left: 35%;
            transform: translateX(-50%);
            /* Centers the dropdown content horizontally */
            background-color: rgba(129, 183, 201, 0.6);
            min-width: 100px;
            box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
            z-index: 9999;
            text-align: center;
            font-weight: bold;
            border-radius: 4px;
            border: 1px solid rgba(95, 149, 167, 0.6);
        }

        .dropdown-content a {
            color: black;
            padding: 7px 8px;
            text-decoration: none;
            display: block;
        }

        .dropdown-content a:hover {
            background-color: rgba(64, 142, 169, 0.6);
            color: white;
        }

        .bg {
            background-color: rgba(64, 142, 169, 0.6) !important;
            color: white;
            /* Optional: ensures text is visible on a red background */
        }

        .submodule-button .settings-icon {
            font-size: 9px;
            /* Adjust icon size */
            color: white;
            margin-left: 5px;
            margin-right: 1px;
            /* Adds space between the icon and text */
            cursor: pointer;
        }

        iframe {
            position: fixed;
            top: 61px;
            /* Matches the height of the title bar */
            left: 167px;
            /* Matches the width of the sidebar */
            width: calc(100% - 167px);
            /* Full width minus the sidebar width */
            height: calc(100% - 61px);
            /* Full height minus the title bar height */
            border: none;
            z-index: 1;
            /* iframe overlaps other content */
        }

        .submodule-button a {
            color: white;
            /* Set text color to white */
            text-decoration: none;
            /* Remove underline */
        }

        .submodule-button a:hover {
            color: lightgray;
            /* Optional: Change color on hover */
        }

        /* Bell icon container */
        .bell-container {
            position: relative;
        }

        .bell-button {
            background-color: #0c609d;
            margin-top: 6px;
            margin-right: 18px;
            color: white;
            border: none;
            border-radius: 50%;
            width: 38px;
            height: 38px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            border: 1px solid black;
        }

        .bell-button i {
            font-size: 20px;
        }

        /* Notification badge */
        .badge {
            position: absolute;
            top: -5px;
            right: -10px;
            background-color: red;
            color: white;
            border-radius: 50%;
            padding: 3px 6px;
            font-size: 10px;
            font-weight: bold;
            display: none;
            /* Hidden by default */
        }


        /* Modal styling */
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-40%, -50%);
            /* This ensures the modal is centered */
            background-color: #0c609d;
            border-radius: 6px;
            /* Transparent background */
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 15px;
            width: 50%;
            /* Increase the modal width */
            max-width: 1200px;
            /* Optional: Set a maximum width */
            left: 53%;
            transform: translate(-50%, -50%);
            border: 1px solid #0c609d;
            /* Add a red outer border */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .modal-content {
            width: 100%;
            text-align: center;
            border-radius: 5px;
            /* Apply 5px rounded corners to the outer modal container */
            overflow: hidden;
            /* Ensures child elements respect the border radius */
            /* border: 2px solid red; */
        }

        /* Modal header with blue background */
        .modal-header {
            font-size: 18px;
            font-weight: bold;
            background-color: #0c609d;
            /* Blue background */
            color: white;
            /* White text */
            padding: 15px;
            margin: 0;
            border-radius: 10px 10px 0 0;
            /* Rounded top corners */
            text-align: center;
        }

        /* Modal body - Remove spacing and set consistent background */
        .modal-body {
            padding-left: 0;
            margin: 0;
        }

        .modal-body p:first-child {
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }

        .modal-body p:last-child {
            border-bottom-left-radius: 5px;
            border-bottom-right-radius: 5px;
        }

        /* Modal body content (paragraphs inside the modal) */
        .modal-body p {
            margin: 0;
            /* Remove margin between paragraphs */
            padding: 15px;
            /* Consistent padding around each notification */
            background-color: #e3f4ff;
        }

        /* Alternate background color for even items */
        .modal-body p:nth-child(even) {
            background-color: #ffffff;
        }

        /* Red circle with white X */
        .modal-close-circle {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 16px;
            height: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: red;
            color: white;
            font-size: 10px;
            font-weight: bold;
            border-radius: 50%;
            cursor: pointer;
        }

        .modal-close-circle:hover {
            background-color: darkred;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body style="background-color: #e3f4ff;">
    <div class="title-bar">
        <div class="left-section">
            <img src="{{ url_for('static', filename='images/LOGO.png') }}" alt="Company Logo" class="company-logo">
        </div>
        <div class="company-name">
            TSE Control System<br>
            <div class="client-name" style="margin-top: 5px;">
                {{ client_name }}
            </div>
        </div>
        <div class="right-section">
            <!-- Alarm Notification Icon -->
            <!-- Button to trigger the alarm modal -->
            <div class="bell-container">
                <button class="bell-button" onclick="showAlarmlists()">
                    <i class="fa fa-bell"></i>
                    <span id="alarm-count" class="badge">0</span>
                </button>
            </div>



            {% if session['userloggedin'] %}
            <div class="dropdown">
                <button class="profile-icon" onclick="toggleDropdown()">
                    {{ session['username'][0]|upper }}
                </button>
                <div class="dropdown-content">
                    <a href="{{ url_for('logout') }}">Logout</a>
                </div>
            </div>

            <!-- Tooltip for profile information -->
            <div id="profile-tooltip" class="tooltip-content">
                <p><strong style="color: #003054;">User Name:</strong> {{ session['username'] }}</p>
                <p><strong style="color: #003054;">Last Login:</strong> {{ session['last_login'] }}</p>
            </div>

            {% else %}
            <a href="{{ url_for('user_login') }}" class="login-button">Login</a>
            {% endif %}
        </div>
    </div>

    <div class="modal" id="alarmModal">
        <div class="modal-content">
            <div class="modal-header">
                Alarm Notifications
                <span class="modal-close-circle" onclick="closeModal()">&#10005;</span>
            </div>
            <div class="modal-body" id="alarm-modal-body">
                <!-- Alarm messages will be dynamically inserted here -->
            </div>
        </div>
    </div>


    <div class="sidebar">
        <button id="home" class="module-button" onclick="window.location.href='/dashboard'">
            <i class="fa-solid fa-house"></i> Home
        </button>
        <div id="homeSubmodules" class="submodule-container"></div>

        <!-- <button id="departments" class="module-button">
            <i class="fa-solid fa-building"></i> Departments
        </button> -->

        <!-- <div id="departmentsSubmodules" class="submodule-container">
            {% for submodule in submodules %}
            <button class="submodule-button"
                onclick="window.location.href='/{{ submodule | lower | replace(' ', '') }}'">
                {{ submodule }}
                <i class="fa-solid fa-chevron-down dropdown-icon"></i>
            </button>
            {% endfor %}

            <div id="dropdownSubmodules" class="submodule-container">
                {% for submodule in allowed_submodules %}
                <button class="submodule-button bg"><i class="fa-solid fa-gear settings-icon"></i>{{ submodule
                    }}</button>
                {% endfor %}
            </div>
        </div> -->

        <button id="departments" class="module-button">
            <i class="fa-solid fa-building"></i> Departments
        </button>
        <div id="departmentsSubmodules" class="submodule-container">
            {% for submodule, template in submodules.items() %}
            <button class="submodule-button">
                <a href="{{ url_for('render_submodule', submodule=submodule) }}">
                    {{ submodule }}
                </a>
                <i class="fa-solid fa-chevron-down dropdown-icon"
                    onclick="toggleSubmodules('{{ submodule | replace(' ', '_') }}Submodules', this)"></i>
            </button>

            <div id="{{ submodule | replace(' ', '_') }}Submodules" class="submodule-container">
                <!-- Conditionally display the Dashboard button -->
                {% if dashboard_name %}
                <button class="submodule-button bg">
                    <i class="fa-solid fa-home" style="font-size: 9px; margin-left: 5px; padding-right: 5px;"></i>
                    {{ dashboard_name }}
                </button>
                {% endif %}

                <!-- Add submodule options here -->
                {% for submodule_option in allowed_submodules %}
                <button class="submodule-button bg">
                    <i class="fa-solid fa-gear settings-icon"></i> {{ submodule_option }}
                </button>
                {% endfor %}
            </div>
            {% endfor %}
        </div>


        <button id="alarms" class="module-button" onclick="window.location.href='/alarmlists'">
            <i class="fa-solid fa-triangle-exclamation"></i> Alarms
        </button>
        <div id="alarmsSubmodules" class="submodule-container"></div>


        <button id="reports" class="module-button">
            <i class="fa-solid fa-file"></i> Analytics
        </button>
        <div id="reportsSubmodules" class="submodule-container">
            <button class="submodule-button" onclick="showIframe('trendsIframe')">Trends</button>
            <button class="submodule-button" onclick="showIframe('reportIframe')">Reports</button>
        </div>

        {% if session['role'] == 'Tsee' %}
        <button id="usermanagement" class="module-button">
            <i class="fa-solid fa-user-cog"></i> User Management
        </button>
        <div id="usermanagementSubmodules" class="submodule-container">
            <!-- <button class="submodule-button">Add User</button> -->
            <button class="submodule-button" onclick="window.location.href='/add_user'">
                <i class="fa-solid fa-user-plus"></i> Add User
            </button>

            <!-- <button class="submodule-button">Edit & Delete</button> -->
            <button class="submodule-button" onclick="window.location.href='/user_management'">
                <i class="fa-solid fa-user-pen"></i> Update user
            </button>
        </div>
        {% endif %}
    </div>

    <div>
        <iframe id="reportIframe" src="http://127.0.0.1:5001/report" style="display: none;"></iframe>
    </div>

    <div>
        <iframe id="trendsIframe" src="http://127.0.0.1:3000" style="display: none;"></iframe>
    </div>

    <div class="content">
        {% block content %}
        <!-- Default content (if any) -->
        {% endblock %}
    </div>

    <script>
        let previousAlarms = [];

        function fetchAlarmCount() {
            fetch("/alarms")
                .then(response => response.json())
                .then(data => {
                    const alarmCountElement = document.getElementById("alarm-count");
                    const alarmCount = data.length;

                    if (alarmCount > 0) {
                        // Show the badge and update the count
                        alarmCountElement.style.display = "inline-block";
                        alarmCountElement.innerText = alarmCount;
                    } else {
                        // Hide the badge
                        alarmCountElement.style.display = "none";
                    }

                    // Check for new alarms and update modal body
                    const newAlarms = data.filter(alarm => !previousAlarms.some(a => a.alarm === alarm.alarm));
                    if (newAlarms.length > 0) {
                        const alarmMessage = newAlarms.map(a => `<p>${a.message} (${a.name})</p>`).join("");
                        document.getElementById("alarm-modal-body").innerHTML = alarmMessage;
                    }

                    previousAlarms = data;
                });
        }



        function showAlarmlists() {
            // Reset alarm count to 0 when modal is opened
            document.getElementById("alarm-count").innerText = 0;

            // Fetch alarms and update the modal body
            fetch("/alarms")
                .then(response => response.json())
                .then(data => {
                    let alarmMessage = "";

                    if (data.length === 0) {
                        alarmMessage = "<p>No alarm notifications yet.</p>";
                    } else {
                        // Loop through data and format each alarm with alternating styles
                        alarmMessage = data.map((a, index) => {
                            // Dynamically add classes based on even/odd index
                            const className = (index % 2 === 0) ? 'even' : 'odd';
                            return `<p class="${className}">${a.message} (${a.name})</p>`;
                        }).join("");
                    }

                    // Update modal body with alarm messages
                    document.getElementById("alarm-modal-body").innerHTML = alarmMessage;

                    // Show the modal
                    document.getElementById("alarmModal").style.display = "flex";
                });
        }



        function closeModal() {
            // Hide the modal
            document.getElementById("alarmModal").style.display = "none";
        }

        // Call the function periodically to check for new alarms
        setInterval(fetchAlarmCount, 10000);


        var iframe = document.getElementById('reportIframe');
        iframe.style.display = 'none';

        var iframe = document.getElementById('trendsIframe');
        iframe.style.display = 'none';

        function showIframe(iframeId) {
            // Hide all iframes
            document.querySelectorAll('iframe').forEach(iframe => {
                iframe.style.display = 'none';
            });

            // Show the selected iframe
            document.getElementById(iframeId).style.display = 'block';
        }

        document.addEventListener("DOMContentLoaded", function () {
            const moduleButtons = document.querySelectorAll(".module-button");
            const submoduleContainers = document.querySelectorAll(".submodule-container");

            // Toggle dropdown visibility
            moduleButtons.forEach(button => {
                button.addEventListener("click", function (event) {
                    event.stopPropagation(); // Prevent the document click event from firing

                    // Get the corresponding submodule container
                    const associatedDropdown = this.nextElementSibling;

                    // Close other dropdowns except the current one
                    submoduleContainers.forEach(container => {
                        if (container !== associatedDropdown) {
                            container.style.display = "none";
                        }
                    });

                    // Toggle visibility of the current dropdown
                    if (associatedDropdown) {
                        associatedDropdown.style.display =
                            associatedDropdown.style.display === "block" ? "none" : "block";
                    }
                });
            });

            // Close dropdowns when clicking anywhere outside
            document.addEventListener("click", function () {
                submoduleContainers.forEach(container => {
                    container.style.display = "none";
                });
            });

            // Prevent closing dropdown when clicking inside it
            submoduleContainers.forEach(container => {
                container.addEventListener("click", function (event) {
                    event.stopPropagation(); // Ensure clicks inside the container don't propagate
                });
            });
        });

        function showTooltip() {
            var tooltip = document.getElementById('profile-tooltip');
            tooltip.style.display = 'block'; // Show tooltip
        }

        function hideTooltip() {
            var tooltip = document.getElementById('profile-tooltip');
            tooltip.style.display = 'none'; // Hide tooltip
        }

        function toggleDropdown() {
            var dropdownContent = document.querySelector('.dropdown-content');
            dropdownContent.style.display = (dropdownContent.style.display === 'block') ? 'none' : 'block';
        }

        $(document).ready(function () {
            // Toggle dropdown for module buttons
            $(".module-button").on("click", function (event) {
                // Prevent the event from propagating to the document
                event.stopPropagation();

                // Get the associated submodule container
                var associatedDropdown = $(this).next(".submodule-container");

                // Close all other open dropdowns except the clicked one
                $(".submodule-container").not(associatedDropdown).slideUp();

                // Toggle the visibility of the associated dropdown
                associatedDropdown.slideToggle();
            });

            // Prevent closing when clicking inside the submodule container
            $(".submodule-container").on("click", function (event) {
                event.stopPropagation();
            });

            // Close the dropdown when clicking outside of it
            $(document).on("click", function () {
                $(".submodule-container").slideUp();
            });

            // Check if the URL matches 127.0.0.1:7005 and hide all submodule containers
            if (window.location.href === "http://127.0.0.1:7005/") {
                $(".submodule-container").css("display", "none");
            }

            // Show tooltip on hover over the profile icon
            $('.profile-icon').hover(
                function () {
                    $('#profile-tooltip').show();
                },
                function () {
                    $('#profile-tooltip').hide();
                }
            );
        });

        // Function to toggle submodule visibility
        function toggleSubmodules(submoduleId, iconElement) {
            const submodule = document.getElementById(submoduleId);
            const isVisible = submodule.style.display === "block";

            // Toggle visibility
            submodule.style.display = isVisible ? "none" : "block";

            // Store the state in localStorage
            localStorage.setItem(submoduleId, submodule.style.display);

            // Toggle the icon based on visibility
            iconElement.classList.toggle("fa-chevron-down", isVisible);
            iconElement.classList.toggle("fa-chevron-up", !isVisible);
        }

        // Restore dropdown visibility from localStorage on page load
        window.onload = function () {
            const submoduleContainers = document.querySelectorAll('.submodule-container');
            submoduleContainers.forEach(container => {
                const submoduleId = container.id;
                const savedState = localStorage.getItem(submoduleId);
                if (savedState) {
                    container.style.display = savedState;
                }
            });

            // Update icons based on saved visibility states
            const icons = document.querySelectorAll('.dropdown-icon');
            icons.forEach(icon => {
                const submoduleId = icon.parentElement.nextElementSibling.id;
                const isVisible = localStorage.getItem(submoduleId) === "block";
                icon.classList.toggle("fa-chevron-down", !isVisible);
                icon.classList.toggle("fa-chevron-up", isVisible);
            });
        };

        // Load submodule states from localStorage on page load
        function loadSubmoduleStates() {
            const submodules = document.querySelectorAll('.submodule-container');
            submodules.forEach(submodule => {
                const submoduleId = submodule.id;
                const savedState = localStorage.getItem(submoduleId);
                if (savedState) {
                    submodule.style.display = savedState;
                }
            });
        }

        // Call the function to load states on page load
        loadSubmoduleStates();

        // Add event listeners for the modules
        document.getElementById("departments").addEventListener("click", function (event) {
            event.preventDefault(); // Prevent page reload
            toggleSubmodules("departmentsSubmodules", this.querySelector(".dropdown-icon"));
        });

        document.getElementById("alarms").addEventListener("click", function (event) {
            event.preventDefault(); // Prevent page reload
            toggleSubmodules("alarmsSubmodules", this.querySelector(".dropdown-icon"));
        });

        document.getElementById("reports").addEventListener("click", function (event) {
            event.preventDefault(); // Prevent page reload
            toggleSubmodules("reportsSubmodules", this.querySelector(".dropdown-icon"));
        });

        document.getElementById("usermanagement").addEventListener("click", function (event) {
            event.preventDefault(); // Prevent page reload
            toggleSubmodules("usermanagementSubmodules", this.querySelector(".dropdown-icon"));
        });

        document.getElementById("spinning2").addEventListener("click", function (event) {
            event.preventDefault(); // Prevent page reload
            toggleSubmodules("spinning2Submodules", this.querySelector(".dropdown-icon"));
        });

        // Automatically hide submodules initially
        document.querySelectorAll('.submodule-container').forEach(function (submodule) {
            submodule.style.display = 'none';
        });

        // Run this on page load to retain the states
        document.addEventListener('DOMContentLoaded', loadSubmoduleStates);
    </script>

</body>

</html>















<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}TSE Control System{% endblock %}</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


    <style>
        body {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        html,
        body {
            height: 100%;
        }

        .sidebar {
            position: fixed;
            width: 168px;
            height: 90%;
            top: 60px;
            left: -2px;
            background-color: #3273a1;
            padding-top: 2px;
            color: white;
            border-right: 3px solid rgba(173, 216, 230, 0.6);
            overflow-y: scroll;
            /* Enable scrolling */
            -ms-overflow-style: none;
            /* Hide scrollbar in IE 10+ */
            scrollbar-width: none;
            /* Hide scrollbar in Firefox */
        }

        .sidebar::-webkit-scrollbar {
            display: none;
            /* Hide scrollbar in Chrome, Safari, and Edge */
        }



        .module-button {
            display: flex;
            align-items: center;
            width: 100%;
            background: linear-gradient(rgba(0, 51, 102, 0.9) 0%, rgba(173, 216, 230, 0.6) 98%);
            color: rgb(238, 238, 255);
            padding-left: 15px;
            padding-top: 12px;
            padding-bottom: 12px;
            text-align: left;
            border: none;
            outline: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: background-color 0.3s ease;
            border-bottom: 0.2px solid black;
            position: relative;
            font-style: Roboto Mono;
        }

        .module-button:hover {
            background-color: #005fa3;
        }



        .submodule-container {
            display: none;
            background: linear-gradient(rgba(0, 51, 102, 0.9) 0%, rgba(173, 216, 230, 0.6) 98%);
        }


        .submodule-button {
            width: 100%;
            background-color: rgba(0, 99, 132, 0.6);
            color: white;
            padding-left: 32px;
            padding-bottom: 10px;
            padding-top: 10px;
            font-weight: 600;
            border: none;
            outline: none;
            font-size: 12px;
            margin-bottom: 0px;
            text-align: left;
            /* cursor: pointer; */
            border-bottom: 1px solid black;
            position: relative;
        }

        .submodule-button:hover {
            background-color: #005fa3;
        }

        .dropdown-icon {
            position: absolute;
            right: 12px;
            font-size: 12px;
            cursor: pointer;
        }

        .content {
            margin-left: 160px;
            padding: 20px;
        }

        .fa-house,
        .fa-building,
        .fa-triangle-exclamation,
        .fa-gear,
        .fa-file,
        .fa-user-cog {
            font-size: 11px;
            padding-right: 7px;
        }

        .fa-user-plus,
        .fa-user-pen {
            font-size: 10px;
            padding-right: 6px;
        }

        .active {
            background-color: #003e6d;
            /* Darker background for the active button */
        }

        .title-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(rgba(0, 51, 102, 0.9) 0%, rgba(173, 216, 230, 0.6) 98%);
            background-color: #005fa3;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            border-bottom: 3px solid rgba(173, 216, 230, 0.6);
        }

        .company-logo {
            margin-top: 8px;
            height: 40px;
            width: 40px;
            margin-left: 28px;
            background-color: white;
            border-radius: 50px;
        }

        .company-name {
            font-size: 24px;
            font-weight: bold;
            flex-grow: 1;
            text-align: center;
            color: white;
        }

        .client-name {
            font-size: 15px;
            font-weight: bold;
            flex-grow: 1;
            text-align: center;
            color: white;
        }

        .left-section {
            display: flex;
            border-right: 2px solid rgba(173, 216, 230, 0.6);
            top: 0px;
            padding-right: 78px;
            width: fit-content;
            height: 60px;
        }

        .login-button {
            font-size: 14px;
            color: #fff;
            background-color: #005fa3;
            margin-top: 6px;
            padding: 8px 18px;
            border: 1px solid black;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-right: 8px;
            text-decoration: none;
        }

        .login-button:hover {
            background-color: #003e6d;
        }

        .right-section {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            width: auto;
        }

        .profile-icon-button {
            background-color: transparent;
            border: none;
            cursor: pointer;
            color: white;
            font-size: 24px;
            position: relative;
        }

        .profile-icon-button:hover {
            color: #003e6d;
            cursor: pointer;
        }

        /* Circle profile icon styles */
        .profile-icon {
            position: relative;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: #005fa3;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            font-weight: bold;
            margin-right: 10px;
            border: 2px solid #005591;
            margin-top: 6px;
            cursor: pointer;
        }

        /* Tooltip content style */
        .tooltip-content {
            position: absolute;
            top: 9%;
            /* Position it just below the profile icon */
            left: 87%;
            /* Center it horizontally */
            transform: translateX(-50%);
            /* Adjust for perfect centering */
            width: 180px;
            /* Set the desired width */
            height: 40px;
            /* Set the desired height */
            background-color: rgba(129, 183, 201, 0.6);
            color: black;
            padding: 6px;
            /* Add some padding inside */
            border-radius: 5px;
            box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
            font-size: 14px;
            z-index: 2;
            display: none;
            /* Initially hidden */
            overflow: hidden;
            /* Ensures content does not overflow outside the tooltip */
            text-overflow: ellipsis;
            /* Adds ellipsis if the text overflows */
            white-space: nowrap;
            /* Prevents text from breaking into multiple lines */
            border: 1px solid rgba(95, 149, 167, 0.6);
            /* text-align: center; */

        }

        .tooltip-content p {
            margin: 0;
            /* Remove any default margins */
            overflow: hidden;
            /* Prevent content overflow */
            text-overflow: ellipsis;
            /* Add ellipsis for overflowing text */
            line-height: 24px;
            /* Adjust line height for better readability */
            font-size: 12px;
            /* Adjust font size if needed */
            word-wrap: break-word;
            /* Ensures content breaks correctly if needed */
            font-weight: bold;
        }


        /* Show the tooltip when hovering over the profile icon */
        .profile-icon:hover+#profile-tooltip {
            display: block;
        }


        /* Dropdown menu styles */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            top: 58px;
            /* Adjust this to position the dropdown below the profile icon */
            left: 35%;
            transform: translateX(-50%);
            /* Centers the dropdown content horizontally */
            background-color: rgba(129, 183, 201, 0.6);
            min-width: 100px;
            box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
            z-index: 9999;
            text-align: center;
            font-weight: bold;
            border-radius: 4px;
            border: 1px solid rgba(95, 149, 167, 0.6);
        }

        .dropdown-content a {
            color: black;
            padding: 7px 8px;
            text-decoration: none;
            display: block;
        }

        .dropdown-content a:hover {
            background-color: rgba(64, 142, 169, 0.6);
            color: white;
        }

        .bg {
            background-color: rgba(64, 142, 169, 0.6) !important;
            color: white;
            /* Optional: ensures text is visible on a red background */
        }

        .submodule-button .settings-icon {
            font-size: 9px;
            /* Adjust icon size */
            color: white;
            margin-left: 5px;
            margin-right: 1px;
            /* Adds space between the icon and text */
            cursor: pointer;
        }

        iframe {
            position: fixed;
            top: 61px;
            /* Matches the height of the title bar */
            left: 167px;
            /* Matches the width of the sidebar */
            width: calc(100% - 167px);
            /* Full width minus the sidebar width */
            height: calc(100% - 61px);
            /* Full height minus the title bar height */
            border: none;
            z-index: 1;
            /* iframe overlaps other content */
        }

        .submodule-button a {
            color: white;
            /* Set text color to white */
            text-decoration: none;
            /* Remove underline */
        }

        .submodule-button a:hover {
            color: lightgray;
            /* Optional: Change color on hover */
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body style="background-color: #e3f4ff;">
    <div class="title-bar">
        <div class="left-section">
            <img src="{{ url_for('static', filename='images/LOGO.png') }}" alt="Company Logo" class="company-logo">
        </div>
        <div class="company-name">
            TSE Control System<br>
            <div class="client-name" style="margin-top: 5px;">
                {{ client_name }}
            </div>
        </div>
        <div class="right-section">
            <!-- Alarm Notification Icon -->
            <!-- Alarm Notification Icon -->
            <div style="position: relative;">
                <button class="btn btn-danger" onclick="showAcknowledgement()">
                    <i class="fa fa-bell"></i>
                    <span id="alarm-count" class="badge badge-light"
                        style="position: absolute; top: -5px; right: -10px;">0</span>
                </button>
            </div>



            {% if session['userloggedin'] %}
            <div class="dropdown">
                <button class="profile-icon" onclick="toggleDropdown()">
                    {{ session['username'][0]|upper }}
                </button>
                <div class="dropdown-content">
                    <a href="{{ url_for('logout') }}">Logout</a>
                </div>
            </div>

            <!-- Tooltip for profile information -->
            <div id="profile-tooltip" class="tooltip-content">
                <p><strong style="color: #003054;">User Name:</strong> {{ session['username'] }}</p>
                <p><strong style="color: #003054;">Last Login:</strong> {{ session['last_login'] }}</p>
            </div>

            {% else %}
            <a href="{{ url_for('user_login') }}" class="login-button">Login</a>
            {% endif %}
        </div>
    </div>

    <!-- Modal for Real-time Alarms -->
    <div class="modal fade" id="alarmModal" tabindex="-1" aria-labelledby="alarmModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="alarmModalLabel">Acknowledgement</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="alarm-modal-body">
                    <!-- Alarm message will be dynamically inserted here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Acknowledge</button>
                </div>
            </div>
        </div>
    </div>

    <div class="sidebar">
        <button id="home" class="module-button" onclick="window.location.href='/dashboard'">
            <i class="fa-solid fa-house"></i> Home
        </button>
        <div id="homeSubmodules" class="submodule-container"></div>

        <!-- <button id="departments" class="module-button">
            <i class="fa-solid fa-building"></i> Departments
        </button> -->

        <!-- <div id="departmentsSubmodules" class="submodule-container">
            {% for submodule in submodules %}
            <button class="submodule-button"
                onclick="window.location.href='/{{ submodule | lower | replace(' ', '') }}'">
                {{ submodule }}
                <i class="fa-solid fa-chevron-down dropdown-icon"></i>
            </button>
            {% endfor %}

            <div id="dropdownSubmodules" class="submodule-container">
                {% for submodule in allowed_submodules %}
                <button class="submodule-button bg"><i class="fa-solid fa-gear settings-icon"></i>{{ submodule
                    }}</button>
                {% endfor %}
            </div>
        </div> -->

        <button id="departments" class="module-button">
            <i class="fa-solid fa-building"></i> Departments
        </button>
        <div id="departmentsSubmodules" class="submodule-container">
            {% for submodule, template in submodules.items() %}
            <button class="submodule-button">
                <a href="{{ url_for('render_submodule', submodule=submodule) }}">
                    {{ submodule }}
                </a>
                <i class="fa-solid fa-chevron-down dropdown-icon"
                    onclick="toggleSubmodules('{{ submodule | replace(' ', '_') }}Submodules', this)"></i>
            </button>

            <div id="{{ submodule | replace(' ', '_') }}Submodules" class="submodule-container">
                <!-- Conditionally display the Dashboard button -->
                {% if dashboard_name %}
                <button class="submodule-button bg">
                    <i class="fa-solid fa-home" style="font-size: 9px; margin-left: 5px; padding-right: 5px;"></i>
                    {{ dashboard_name }}
                </button>
                {% endif %}

                <!-- Add submodule options here -->
                {% for submodule_option in allowed_submodules %}
                <button class="submodule-button bg">
                    <i class="fa-solid fa-gear settings-icon"></i> {{ submodule_option }}
                </button>
                {% endfor %}
            </div>
            {% endfor %}
        </div>


        <button id="alarms" class="module-button" onclick="window.location.href='/alarm_acknowledgement'">
            <i class="fa-solid fa-triangle-exclamation"></i> Alarms
        </button>
        <div id="alarmsSubmodules" class="submodule-container"></div>


        <button id="reports" class="module-button">
            <i class="fa-solid fa-file"></i> Analytics
        </button>
        <div id="reportsSubmodules" class="submodule-container">
            <button class="submodule-button" onclick="showIframe('trendsIframe')">Trends</button>
            <button class="submodule-button" onclick="showIframe('reportIframe')">Reports</button>
        </div>

        {% if session['role'] == 'Tsee' %}
        <button id="usermanagement" class="module-button">
            <i class="fa-solid fa-user-cog"></i> User Management
        </button>
        <div id="usermanagementSubmodules" class="submodule-container">
            <!-- <button class="submodule-button">Add User</button> -->
            <button class="submodule-button" onclick="window.location.href='/add_user'">
                <i class="fa-solid fa-user-plus"></i> Add User
            </button>

            <!-- <button class="submodule-button">Edit & Delete</button> -->
            <button class="submodule-button" onclick="window.location.href='/user_management'">
                <i class="fa-solid fa-user-pen"></i> Update user
            </button>
        </div>
        {% endif %}
    </div>

    <div>
        <iframe id="reportIframe" src="http://127.0.0.1:5001/report" style="display: none;"></iframe>
    </div>

    <div>
        <iframe id="trendsIframe" src="http://127.0.0.1:3000" style="display: none;"></iframe>
    </div>

    <div class="content">
        {% block content %}
        <!-- Default content (if any) -->
        {% endblock %}
    </div>

    <script>
        let previousAlarms = [];

        function fetchAlarmCount() {
            $.getJSON("/alarms", function (data) {
                document.getElementById("alarm-count").innerText = data.length;

                // Check for new alarms
                const newAlarms = data.filter(alarm => !previousAlarms.some(a => a.alarm === alarm.alarm));
                if (newAlarms.length > 0) {
                    const alarmMessage = newAlarms.map(a => `<p>${a.message} (${a.name})</p>`).join("");
                    $("#alarm-modal-body").html(alarmMessage);
                }

                previousAlarms = data;
            });
        }

        function showAcknowledgement() {
            $("#alarmModal").modal("show");
        }

        setInterval(fetchAlarmCount, 3000);


        var iframe = document.getElementById('reportIframe');
        iframe.style.display = 'none';

        var iframe = document.getElementById('trendsIframe');
        iframe.style.display = 'none';

        function showIframe(iframeId) {
            // Hide all iframes
            document.querySelectorAll('iframe').forEach(iframe => {
                iframe.style.display = 'none';
            });

            // Show the selected iframe
            document.getElementById(iframeId).style.display = 'block';
        }

        document.addEventListener("DOMContentLoaded", function () {
            const moduleButtons = document.querySelectorAll(".module-button");
            const submoduleContainers = document.querySelectorAll(".submodule-container");

            // Toggle dropdown visibility
            moduleButtons.forEach(button => {
                button.addEventListener("click", function (event) {
                    event.stopPropagation(); // Prevent the document click event from firing

                    // Get the corresponding submodule container
                    const associatedDropdown = this.nextElementSibling;

                    // Close other dropdowns except the current one
                    submoduleContainers.forEach(container => {
                        if (container !== associatedDropdown) {
                            container.style.display = "none";
                        }
                    });

                    // Toggle visibility of the current dropdown
                    if (associatedDropdown) {
                        associatedDropdown.style.display =
                            associatedDropdown.style.display === "block" ? "none" : "block";
                    }
                });
            });

            // Close dropdowns when clicking anywhere outside
            document.addEventListener("click", function () {
                submoduleContainers.forEach(container => {
                    container.style.display = "none";
                });
            });

            // Prevent closing dropdown when clicking inside it
            submoduleContainers.forEach(container => {
                container.addEventListener("click", function (event) {
                    event.stopPropagation(); // Ensure clicks inside the container don't propagate
                });
            });
        });

        function showTooltip() {
            var tooltip = document.getElementById('profile-tooltip');
            tooltip.style.display = 'block'; // Show tooltip
        }

        function hideTooltip() {
            var tooltip = document.getElementById('profile-tooltip');
            tooltip.style.display = 'none'; // Hide tooltip
        }

        function toggleDropdown() {
            var dropdownContent = document.querySelector('.dropdown-content');
            dropdownContent.style.display = (dropdownContent.style.display === 'block') ? 'none' : 'block';
        }

        $(document).ready(function () {
            // Toggle dropdown for module buttons
            $(".module-button").on("click", function (event) {
                // Prevent the event from propagating to the document
                event.stopPropagation();

                // Get the associated submodule container
                var associatedDropdown = $(this).next(".submodule-container");

                // Close all other open dropdowns except the clicked one
                $(".submodule-container").not(associatedDropdown).slideUp();

                // Toggle the visibility of the associated dropdown
                associatedDropdown.slideToggle();
            });

            // Prevent closing when clicking inside the submodule container
            $(".submodule-container").on("click", function (event) {
                event.stopPropagation();
            });

            // Close the dropdown when clicking outside of it
            $(document).on("click", function () {
                $(".submodule-container").slideUp();
            });

            // Check if the URL matches 127.0.0.1:7005 and hide all submodule containers
            if (window.location.href === "http://127.0.0.1:7005/") {
                $(".submodule-container").css("display", "none");
            }

            // Show tooltip on hover over the profile icon
            $('.profile-icon').hover(
                function () {
                    $('#profile-tooltip').show();
                },
                function () {
                    $('#profile-tooltip').hide();
                }
            );
        });

        // Function to toggle submodule visibility
        function toggleSubmodules(submoduleId, iconElement) {
            const submodule = document.getElementById(submoduleId);
            const isVisible = submodule.style.display === "block";

            // Toggle visibility
            submodule.style.display = isVisible ? "none" : "block";

            // Store the state in localStorage
            localStorage.setItem(submoduleId, submodule.style.display);

            // Toggle the icon based on visibility
            iconElement.classList.toggle("fa-chevron-down", isVisible);
            iconElement.classList.toggle("fa-chevron-up", !isVisible);
        }

        // Restore dropdown visibility from localStorage on page load
        window.onload = function () {
            const submoduleContainers = document.querySelectorAll('.submodule-container');
            submoduleContainers.forEach(container => {
                const submoduleId = container.id;
                const savedState = localStorage.getItem(submoduleId);
                if (savedState) {
                    container.style.display = savedState;
                }
            });

            // Update icons based on saved visibility states
            const icons = document.querySelectorAll('.dropdown-icon');
            icons.forEach(icon => {
                const submoduleId = icon.parentElement.nextElementSibling.id;
                const isVisible = localStorage.getItem(submoduleId) === "block";
                icon.classList.toggle("fa-chevron-down", !isVisible);
                icon.classList.toggle("fa-chevron-up", isVisible);
            });
        };

        // Load submodule states from localStorage on page load
        function loadSubmoduleStates() {
            const submodules = document.querySelectorAll('.submodule-container');
            submodules.forEach(submodule => {
                const submoduleId = submodule.id;
                const savedState = localStorage.getItem(submoduleId);
                if (savedState) {
                    submodule.style.display = savedState;
                }
            });
        }

        // Call the function to load states on page load
        loadSubmoduleStates();

        // Add event listeners for the modules
        document.getElementById("departments").addEventListener("click", function (event) {
            event.preventDefault(); // Prevent page reload
            toggleSubmodules("departmentsSubmodules", this.querySelector(".dropdown-icon"));
        });

        document.getElementById("alarms").addEventListener("click", function (event) {
            event.preventDefault(); // Prevent page reload
            toggleSubmodules("alarmsSubmodules", this.querySelector(".dropdown-icon"));
        });

        document.getElementById("reports").addEventListener("click", function (event) {
            event.preventDefault(); // Prevent page reload
            toggleSubmodules("reportsSubmodules", this.querySelector(".dropdown-icon"));
        });

        document.getElementById("usermanagement").addEventListener("click", function (event) {
            event.preventDefault(); // Prevent page reload
            toggleSubmodules("usermanagementSubmodules", this.querySelector(".dropdown-icon"));
        });

        document.getElementById("spinning2").addEventListener("click", function (event) {
            event.preventDefault(); // Prevent page reload
            toggleSubmodules("spinning2Submodules", this.querySelector(".dropdown-icon"));
        });

        // Automatically hide submodules initially
        document.querySelectorAll('.submodule-container').forEach(function (submodule) {
            submodule.style.display = 'none';
        });

        // Run this on page load to retain the states
        document.addEventListener('DOMContentLoaded', loadSubmoduleStates);
    </script>

</body>

</html>
=======





>>>>>>> 5646455a506c6e07580a35da132e371028a87e2d
